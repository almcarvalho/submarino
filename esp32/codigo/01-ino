// SUBMARINO ESP32 COM ANTENA (sem relés)
// AQUI É APENAS UM "HELLO WORLD" COM DOIS LEDS PRA TESTAR A CONEXÃO
// COM O CONTROLE DO PS5
// Status: LED VERMELHO (GPIO 14) para conexão
// Evento: LED VERDE (GPIO 16) pisca 100 ms quando QUALQUER tecla é pressionada

#include <ps5Controller.h>

// LEDs
#define LED_VERMELHO 14   // Status de conexão
#define LED_VERDE    16   // Evento de tecla pressionada

// Controle de borda para "qualquer tecla"
bool anyPressedPrev = false;

// Função utilitária: verifica se QUALQUER botão está pressionado
bool anyButtonPressed() {
  // Lista enxuta de botões com bom suporte na lib
  return ps5.Cross()   || ps5.Square() || ps5.Triangle() || ps5.Circle() ||
         ps5.Up()      || ps5.Down()   || ps5.Left()     || ps5.Right()  ||
         ps5.L1()      || ps5.R1()     || ps5.L2()       || ps5.R2();
}

void setup() {
  Serial.begin(9600);

  pinMode(LED_VERMELHO, OUTPUT);
  pinMode(LED_VERDE, OUTPUT);

  digitalWrite(LED_VERMELHO, LOW);
  digitalWrite(LED_VERDE, LOW);

  // Substitua pelo MAC do SEU ESP32 (endereço Bluetooth do ESP32)
  // no meu github em carrinhops5 repositorio tem um codigo la dentro com essa lib ps5 e com 
  // o código de exemplo pra pegar o mac do controle
  // Para emparelhar com o DualSense (PS5), é o ESP32 que "anuncia".
  ps5.begin("58:10:31:bd:52:38");
  Serial.println("Pronto para conectar ao controle PS5...");
}

void loop() {
  if (ps5.isConnected()) {
    // LED vermelho ACESO fixo quando conectado
    digitalWrite(LED_VERMELHO, HIGH);

    // Detecta borda de "qualquer botão pressionado"
    bool anyPressed = anyButtonPressed();
    if (anyPressed && !anyPressedPrev) {
      // Blink rápido no LED verde (100 ms)
      digitalWrite(LED_VERDE, HIGH);
      delay(100);
      digitalWrite(LED_VERDE, LOW);
    }
    anyPressedPrev = anyPressed;

  } else {
    // Não conectado: LED vermelho PISCANDO (pareando/aguardando parear)
    digitalWrite(LED_VERMELHO, HIGH);
    delay(300);
    digitalWrite(LED_VERMELHO, LOW);
    delay(300);

    // Garante LED verde apagado e zera estado
    digitalWrite(LED_VERDE, LOW);
    anyPressedPrev = false;
  }
}
